{% extends 'home/base.html' %}
{% load static %}

{% block title %}PortfolAI Dashboard{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<link rel="stylesheet" href="{% static 'home/dashboard/dashboard.css' %}">
<style>
  /* Override base template styles for dashboard */
  body {
    background-color: #23252e !important;
    color: #8a8fa7 !important;
    font-family: 'Lato', sans-serif !important;
  }
  
  #mainContent {
    padding: 0 !important;
    margin: 0 !important;
  }
  
  /* Sidebar is now visible for dashboard */
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-900 text-slate-100">
  <!-- Ticker Tape Bar -->
  <div class="bg-slate-800 border-b border-slate-700 py-2 px-4 overflow-hidden">
    <div class="flex items-center justify-between">
      <div class="flex-1 overflow-hidden">
        <div class="ticker-scroll flex items-center space-x-8 whitespace-nowrap">
          <!-- Ticker items will be populated by JavaScript -->
          <div class="ticker-item flex items-center space-x-2">
            <span class="ticker-symbol">AAPL</span>
            <span class="ticker-price">$252.29</span>
            <span class="ticker-change positive">+$4.84 (+1.96%)</span>
          </div>
          <div class="ticker-item flex items-center space-x-2">
            <span class="ticker-symbol">GOOGL</span>
            <span class="ticker-price">$253.30</span>
            <span class="ticker-change positive">+$1.43 (+0.57%)</span>
          </div>
          <div class="ticker-item flex items-center space-x-2">
            <span class="ticker-symbol">MSFT</span>
            <span class="ticker-price">$415.26</span>
            <span class="ticker-change negative">-$2.15 (-0.51%)</span>
          </div>
          <div class="ticker-item flex items-center space-x-2">
            <span class="ticker-symbol">TSLA</span>
            <span class="ticker-price">$248.50</span>
            <span class="ticker-change positive">+$5.20 (+2.14%)</span>
          </div>
          <div class="ticker-item flex items-center space-x-2">
            <span class="ticker-symbol">AMZN</span>
            <span class="ticker-price">$3,456.78</span>
            <span class="ticker-change positive">+$12.34 (+0.36%)</span>
          </div>
        </div>
      </div>
              <button type="button" aria-label="Toggle dark mode" data-tooltip="Toggle dark mode" data-side="bottom" onclick="document.dispatchEvent(new CustomEvent('basecoat:theme'))" class="btn-icon-outline size-8 ml-4">
                <span class="hidden dark:block">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
                  </svg>
                </span>
                <span class="block dark:hidden">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="4" />
                    <path d="M12 2v2" />
                    <path d="M12 20v2" />
                    <path d="m4.93 4.93 1.41 1.41" />
                    <path d="m17.66 17.66 1.41 1.41" />
                    <path d="M2 12h2" />
                    <path d="M20 12h2" />
                    <path d="m6.34 17.66-1.41 1.41" />
                    <path d="m19.07 4.93-1.41 1.41" />
                  </svg>
                </span>
              </button>
    </div>
  </div>

          <!-- Search Bar -->
          <div class="bg-slate-800 border-b border-slate-700 py-4">
            <div class="max-w-2xl mx-auto px-4">
              <div class="form">
                <div class="flex space-x-3">
                  <input 
                    type="text" 
                    id="stock-search" 
                    placeholder="ðŸ” Search stocks (e.g., AAPL, Microsoft, Tesla)" 
                    class="input flex-1 text-lg py-3 px-4"
                  >
                  <button id="search-btn" class="btn bg-blue-600 hover:bg-blue-700 text-white px-8 py-3">
                    Search
                  </button>
                </div>
              </div>
              <div id="search-results" class="search-results mt-4"></div>
            </div>
          </div>

  <!-- Main Content Grid -->
  <div class="p-6">
    <!-- Top Row: 3 Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
      <!-- Watchlist Card (Left) -->
      <div class="card">
        <header>
          <h2 class="card-title flex items-center space-x-2">
            <span class="material-icons-outlined text-yellow-400">star</span>
            <span>Watchlist</span>
          </h2>
        </header>
        <section class="h-64 overflow-y-auto">
          <div id="watchlist-container">
            <div class="watchlist-empty text-center py-8" id="watchlist-empty">
              <span class="material-icons-outlined text-4xl text-slate-500 mb-2">star_border</span>
              <p class="text-sm text-slate-400">No stocks in watchlist</p>
            </div>
            <div class="watchlist-grid space-y-3 hidden" id="watchlist-grid">
              <!-- Watchlist items will be populated here -->
            </div>
          </div>
        </section>
      </div>

      <!-- Portfolio Chart Card (Center) -->
      <div class="card">
        <header>
          <h2 class="card-title flex items-center space-x-2">
            <span class="material-icons-outlined text-green-400">show_chart</span>
            <span>Portfolio Performance</span>
          </h2>
        </header>
        <section class="h-64">
          <div id="bar-chart" class="h-full"></div>
        </section>
      </div>

      <!-- Top 5 Trends Card (Right) -->
      <div class="card">
        <header>
          <h2 class="card-title flex items-center space-x-2">
            <span class="material-icons-outlined text-purple-400">trending_up</span>
            <span>Top 5 Trends</span>
          </h2>
        </header>
        <section class="h-64 overflow-y-auto">
          <div class="space-y-2">
            <div class="flex justify-between items-center py-2 border-b border-slate-600">
              <span class="font-semibold text-sm">AAPL</span>
              <span class="text-sm">$252.29</span>
              <span class="text-green-400 text-xs">+1.96%</span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-slate-600">
              <span class="font-semibold text-sm">GOOGL</span>
              <span class="text-sm">$253.30</span>
              <span class="text-green-400 text-xs">+0.57%</span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-slate-600">
              <span class="font-semibold text-sm">MSFT</span>
              <span class="text-sm">$415.26</span>
              <span class="text-red-400 text-xs">-0.51%</span>
            </div>
            <div class="flex justify-between items-center py-2 border-b border-slate-600">
              <span class="font-semibold text-sm">TSLA</span>
              <span class="text-sm">$248.50</span>
              <span class="text-green-400 text-xs">+2.14%</span>
            </div>
            <div class="flex justify-between items-center py-2">
              <span class="font-semibold text-sm">AMZN</span>
              <span class="text-sm">$3,456.78</span>
              <span class="text-green-400 text-xs">+0.36%</span>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Bottom Row: 2 Cards -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- News Card (Left, 1 column) -->
      <div class="card">
        <header>
          <h2 class="card-title flex items-center space-x-2">
            <span class="material-icons-outlined text-blue-400">newspaper</span>
            <span>News</span>
          </h2>
        </header>
        <section class="h-64 overflow-y-auto">
          <div class="space-y-4">
            <div class="border-b border-slate-600 pb-3">
              <h4 class="text-sm font-semibold text-white mb-1">Market Rally Continues</h4>
              <p class="text-xs text-slate-400">Stocks surge on positive earnings reports...</p>
            </div>
            <div class="border-b border-slate-600 pb-3">
              <h4 class="text-sm font-semibold text-white mb-1">Tech Stocks Lead Gains</h4>
              <p class="text-xs text-slate-400">Major tech companies report strong Q4 results...</p>
            </div>
            <div class="border-b border-slate-600 pb-3">
              <h4 class="text-sm font-semibold text-white mb-1">Fed Signals Rate Stability</h4>
              <p class="text-xs text-slate-400">Federal Reserve maintains current interest rates...</p>
            </div>
            <div class="border-b border-slate-600 pb-3">
              <h4 class="text-sm font-semibold text-white mb-1">Energy Sector Recovery</h4>
              <p class="text-xs text-slate-400">Oil prices stabilize after recent volatility...</p>
            </div>
          </div>
        </section>
      </div>

      <!-- Stock Analysis Card (Right, 2 columns) -->
      <div class="lg:col-span-2 card">
        <header>
          <h2 class="card-title flex items-center space-x-2">
            <span class="material-icons-outlined text-orange-400">analytics</span>
            <span>Stock Analysis</span>
          </h2>
        </header>
        <section class="h-64">
          <div class="overflow-x-auto">
            <table class="table w-full">
              <thead>
                <tr>
                  <th class="text-left">Symbol</th>
                  <th class="text-right">Price</th>
                  <th class="text-right">Change</th>
                  <th class="text-right">Volume</th>
                  <th class="text-right">Market Cap</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="font-semibold">AAPL</td>
                  <td class="text-right">$252.29</td>
                  <td class="text-right text-green-400">+$4.84 (+1.96%)</td>
                  <td class="text-right text-slate-300">45.2M</td>
                  <td class="text-right text-slate-300">$3.89T</td>
                </tr>
                <tr>
                  <td class="font-semibold">GOOGL</td>
                  <td class="text-right">$253.30</td>
                  <td class="text-right text-green-400">+$1.43 (+0.57%)</td>
                  <td class="text-right text-slate-300">28.7M</td>
                  <td class="text-right text-slate-300">$1.67T</td>
                </tr>
                <tr>
                  <td class="font-semibold">MSFT</td>
                  <td class="text-right">$415.26</td>
                  <td class="text-right text-red-400">-$2.15 (-0.51%)</td>
                  <td class="text-right text-slate-300">22.1M</td>
                  <td class="text-right text-slate-300">$3.09T</td>
                </tr>
                <tr>
                  <td class="font-semibold">TSLA</td>
                  <td class="text-right">$248.50</td>
                  <td class="text-right text-green-400">+$5.20 (+2.14%)</td>
                  <td class="text-right text-slate-300">67.8M</td>
                  <td class="text-right text-slate-300">$789.2B</td>
                </tr>
                <tr>
                  <td class="font-semibold">AMZN</td>
                  <td class="text-right">$3,456.78</td>
                  <td class="text-right text-green-400">+$12.34 (+0.36%)</td>
                  <td class="text-right text-slate-300">3.2M</td>
                  <td class="text-right text-slate-300">$1.81T</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>
    </div>

  </div>
  <!-- End Main Content -->
</div>

        <!-- Theme Persistence Script -->
        <script>
        (() => {
          try {
            const stored = localStorage.getItem('themeMode');
            if (stored ? stored === 'dark' : matchMedia('(prefers-color-scheme: dark)').matches) {
              document.documentElement.classList.add('dark');
            }
          } catch (_) {}
          const apply = dark => {
            document.documentElement.classList.toggle('dark', dark);
            try { localStorage.setItem('themeMode', dark ? 'dark' : 'light'); } catch (_) {}
          };
          document.addEventListener('basecoat:theme', (event) => {
            const mode = event.detail?.mode;
            apply(mode === 'dark' ? true : mode === 'light' ? false : !document.documentElement.classList.contains('dark'));
          });
        })();
        </script>
{% endblock %}

{% block extra_js %}
<!-- ApexCharts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.40.0/apexcharts.min.js"></script>
<script src="{% static 'home/dashboard/dashboard.js' %}"></script>
{% endblock %}
